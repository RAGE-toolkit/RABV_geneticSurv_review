plot_world<-
ggplot(data =
world2) +
geom_sf(data=world, fill="white")+
geom_sf(data=world2,aes(fill = Total_Number_of_Sequences))+
scale_fill_gradient2(low='grey96', high='grey20',guide = guide_colourbar(title.position = "top",direction = "vertical"))+
theme(panel.grid.major = element_blank())+
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
rect = element_blank(),
#this bit removes the axis lables
axis.title.y=element_blank(),
axis.title.x=element_blank(),
panel.background = element_rect(fill = "aliceblue"))+
labs(fill = "Number of sequences")
plot_world
## colours for lots of data
n <- 40
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))
## have to manually set the palette based on the above code so as to be able to remove the grey colours
set_pal=c( "#7FC97F" ,"#FDC086" ,"#FFFF99" ,"#F0027F" ,"#BF5B17" ,"#1B9E77" ,"#D95F02"  ,"#E7298A" ,"#66A61E", "#E6AB02","#A6761D" ,"#1F78B4" ,"#B2DF8A" ,"#33A02C" ,"#FB9A99" ,"#E31A1C" ,"#FDBF6F" ,"#FF7F00" ,"#CAB2D6" ,"#6A3D9A" ,"#FFFF99" ,"#B15928", "#FBB4AE" ,"#B3CDE3" ,"#CCEBC5" ,"#DECBE4" ,"#FED9A6" ,"#FFFFCC" ,"#E5D8BD" ,"#FDDAEC" ,"#B3E2CD" ,"#FDCDAC" ,"#CBD5E8" ,"#F4CAE4" ,"#E6F5C9", "#FFF2AE" ,"#F1E2CC" ,"#E41A1C" ,"#377EB8" ,"#4DAF4A", "#984EA3" ,"#FF7F00" ,"#FFFF33" ,"#A65628" ,"#F781BF" ,"#66C2A5" ,"#FC8D62", "#8DA0CB" ,"#E78AC3" ,"#A6D854" ,"#FFD92F", "#E5C494" ,"#8DD3C7" ,"#FFFFB3" ,"#BEBADA" ,"#FB8072" ,"#80B1D3" ,"#FDB462" ,"#B3DE69" ,"#FCCDE5", "#BC80BD" ,"#CCEBC5" ,"#FFED6F")
pie(rep(1,length(col_vector)), col=sample(col_vector, length(col_vector)))
names(col_vector) <- colnames(metadata)[clade_cols]
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = col_vector)
#,label=sort(c(colnames(metadata)[clade_cols])))
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
## add scatterpies on top of shaded map
## currently a problem with ordering the clade legend while maintaining correct colour associations so current version produces an un-alphatised clade legend, which is not ideal!
## have tried many "fixes" but none currently working
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_clade_cols, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_clade_cols, color=NA, alpha=0.8,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_clade_cols, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, color=NA, alpha=0.8,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, color=NA, alpha=0.8,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=  colScale, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=  colScale, color=NA, alpha=0.8,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
colScale
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=  col_vector, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=  col_vector, color=NA, alpha=0.8,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=  col_vector, fill="darkblue",color=NA, alpha=1)
metadata
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=0.8,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
plot_world2<-plot_world +
new_scale("fill")+
# geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=0.8,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
## colours for lots of data
#n <- 40
#qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
#col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))
## have to manually set the palette based on the above code so as to be able to remove the grey colours
set_pal=c( "#7FC97F" ,"#FDC086" ,"#FFFF99" ,"#F0027F" ,"#BF5B17" ,"#1B9E77" ,"#D95F02"  ,"#E7298A" ,"#66A61E", "#E6AB02","#A6761D" ,"#1F78B4" ,"#B2DF8A" ,"#33A02C" ,"#FB9A99" ,"#E31A1C" ,"#FDBF6F" ,"#FF7F00" ,"#CAB2D6" ,"#6A3D9A" ,"#FFFF99" ,"#B15928", "#FBB4AE" ,"#B3CDE3" ,"#CCEBC5" ,"#DECBE4" ,"#FED9A6" ,"#FFFFCC" ,"#E5D8BD" ,"#FDDAEC" ,"#B3E2CD" ,"#FDCDAC" ,"#CBD5E8" ,"#F4CAE4" ,"#E6F5C9", "#FFF2AE" ,"#F1E2CC" ,"#E41A1C" ,"#377EB8" ,"#4DAF4A", "#984EA3" ,"#FF7F00" ,"#FFFF33" ,"#A65628" ,"#F781BF" ,"#66C2A5" ,"#FC8D62", "#8DA0CB" ,"#E78AC3" ,"#A6D854" ,"#FFD92F", "#E5C494" ,"#8DD3C7" ,"#FFFFB3" ,"#BEBADA" ,"#FB8072" ,"#80B1D3" ,"#FDB462" ,"#B3DE69" ,"#FCCDE5", "#BC80BD" ,"#CCEBC5" ,"#FFED6F")
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal)
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
set_pal
#pie(rep(1,length(col_vector)), col=sample(col_vector, length(col_vector)))
names(set_pal) <- colnames(metadata)[clade_cols]
set_pal
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal)
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
ep(1,length(col_vector)), col=sample(col_vector, length(col_vector)))
set_pal
set_pal[names(set_pal)=="Unclassified"]
set_pal[names(set_pal)=="Unclassified"]="black"
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal)
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
set_pal[names(set_pal)=="Unclassified"]="white"
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal)
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
colnames(metadata)[clade_cols]
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal,label=colnames(metadata)[clade_cols])
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")+
scale_fill_discrete(breaks=colnames(metadata)[clade_cols])
plot_world2
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal,label=colnames(metadata)[clade_cols],breaks=colnames(metadata)[clade_cols])
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
colnames(metadata)[clade_cols]
sorted_col_names
# Reorder the dataframe with columns 1 to 3, the sorted columns, and then the remaining columns
metadata_reordered <- metadata[, c(names(metadata)[1:3], sorted_col_names, names(metadata)[continue:ncol(metadata)])]
metadata_reordered
colnames(metadata)[clade_cols]
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal,label=sorted_col_names)
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal,label=sorted_col_names, breaks=sorted_col_names )
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
#pie(rep(1,length(col_vector)), col=sample(col_vector, length(col_vector)))
names(set_pal) <- colnames(metadata)[clade_cols]
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal,label=sorted_col_names, breaks=sorted_col_names )
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
## colours for lots of data
#n <- 40
#qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
#col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))
## have to manually set the palette based on the above code so as to be able to remove the grey colours
set_pal=c( "#7FC97F" ,"#FDC086" ,"#FFFF99" ,"#F0027F" ,"#BF5B17" ,"#1B9E77" ,"#D95F02"  ,"#E7298A" ,"#66A61E", "#E6AB02","#A6761D" ,"#1F78B4" ,"#B2DF8A" ,"#33A02C" ,"#FB9A99" ,"#E31A1C" ,"#FDBF6F" ,"#FF7F00" ,"#CAB2D6" ,"#6A3D9A" ,"#FFFF99" ,"#B15928", "#FBB4AE" ,"#B3CDE3" ,"#CCEBC5" ,"#DECBE4" ,"#FED9A6" ,"#FFFFCC" ,"#E5D8BD" ,"#FDDAEC" ,"#B3E2CD" ,"#FDCDAC" ,"#CBD5E8" ,"#F4CAE4" ,"#E6F5C9", "#FFF2AE" ,"#F1E2CC" ,"#E41A1C" ,"#377EB8" ,"#4DAF4A", "#984EA3" ,"#FF7F00" ,"#FFFF33" ,"#A65628" ,"#F781BF" ,"#66C2A5" ,"#FC8D62", "#8DA0CB" ,"#E78AC3" ,"#A6D854" ,"#FFD92F", "#E5C494" ,"#8DD3C7" ,"#FFFFB3" ,"#BEBADA" ,"#FB8072" ,"#80B1D3" ,"#FDB462" ,"#B3DE69" ,"#FCCDE5", "#BC80BD" ,"#CCEBC5" ,"#FFED6F")
#pie(rep(1,length(col_vector)), col=sample(col_vector, length(col_vector)))
names(set_pal) <- colnames(metadata)[clade_cols]
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal,label=sorted_col_names, breaks=sorted_col_names )
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
set_pal[names(set_pal)=="Unclassified"]="white"
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal,label=sorted_col_names, breaks=sorted_col_names )
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
scatter_leg_fix <-   fix(geom_scatterpie_legend)
# add the scatterpie legend
names=c("1","2-5","6-10",">10")
r=unique(metadata$radius)
plot_world2 +
scatter_leg_fix(radius=r, n=length(unique(names)),x=-100,y=-50,labeller= function(x) x=c(names))
# Save the plots
ggsave("Figures/fig4_scatterpie_clade_90per.pdf", plot =plot_world2 +
scatter_leg_fix(radius=r, n=length(unique(names)),x=-100,y=-50,labeller= function(x) x=c(names))
, width = 11.69, height = 8.27, units="in")
n <- 40
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))
## colours for lots of data
n <- 40
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))
#pie(rep(1,length(col_vector)), col=sample(col_vector, length(col_vector)))
names(col_vector) <- colnames(metadata)[clade_cols]
set_pal[names(col_vector)=="Unclassified"]="white"
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal,label=sorted_col_names, breaks=sorted_col_names )
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = col_vector,label=sorted_col_names, breaks=sorted_col_names )
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
col_vector[names(col_vector)=="Unclassified"]="white"
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = col_vector,label=sorted_col_names, breaks=sorted_col_names )
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
# uncomment and paste this into lines 37:43to implement same (in pop up box in next line of code):
# list(geom_arc_bar(aes_(x0 = ~x, y0 = ~y, r0 = ~r, r = ~r,
# start = ~start, end = ~end), color="darkblue",linewidth=0.1,data = dd, inherit.aes = FALSE),
# geom_segment(aes_(x = ~x, xend = ~sign(x, maxr * 1.5),
#                   y = ~y + r, yend = ~y + r),linetype="dotted",color="darkblue",data = dd, inherit.aes = FALSE),
# geom_text(aes_(x = ~sign(x, maxr * 1.6), y = ~y + r,
#                label = ~label),color="darkblue",data = dd,size=2.5,fontface = "bold",hjust = hjust, inherit.aes = FALSE,
#           ... = ...))
# scatter_leg_fix <-   fix(geom_scatterpie_legend)
# add the scatterpie legend
names=c("1","2-5","6-10",">10")
r=unique(metadata$radius)
plot_world2 +
scatter_leg_fix(radius=r, n=length(unique(names)),x=-100,y=-50,labeller= function(x) x=c(names))
# Save the plots
ggsave("Figures/fig4_scatterpie_clade_90per.pdf", plot =plot_world2 +
scatter_leg_fix(radius=r, n=length(unique(names)),x=-100,y=-50,labeller= function(x) x=c(names))
, width = 11.69, height = 8.27, units="in")
## have to manually set the palette based on the above code so as to be able to remove the grey colours
set_pal=c( "#7FC97F" ,"#FDC086" ,"#FFFF99" ,"#F0027F" ,"#BF5B17" ,"#1B9E77" ,"#D95F02"  ,"#E7298A" ,"#66A61E", "#E6AB02","#A6761D" ,"#1F78B4" ,"#B2DF8A" ,"#33A02C" ,"#FB9A99" ,"#E31A1C" ,"#FDBF6F" ,"#FF7F00" ,"#CAB2D6" ,"#6A3D9A" ,"#FFFF99" ,"#B15928", "#FBB4AE" ,"#B3CDE3" ,"#CCEBC5" ,"#DECBE4" ,"#FED9A6" ,"#FFFFCC" ,"#E5D8BD" ,"#FDDAEC" ,"#B3E2CD" ,"#FDCDAC" ,"#CBD5E8" ,"#F4CAE4" ,"#E6F5C9", "#FFF2AE" ,"#F1E2CC" ,"#E41A1C" ,"#377EB8" ,"#4DAF4A", "#984EA3" ,"#FF7F00" ,"#FFFF33" ,"#A65628" ,"#F781BF" ,"#66C2A5" ,"#FC8D62", "#8DA0CB" ,"#E78AC3" ,"#A6D854" ,"#FFD92F", "#E5C494" ,"#8DD3C7" ,"#FFFFB3" ,"#BEBADA" ,"#FB8072" ,"#80B1D3" ,"#FDB462" ,"#B3DE69" ,"#FCCDE5", "#BC80BD" ,"#CCEBC5" ,"#FFED6F")
## have to manually set the palette based on the above code so as to be able to remove the grey colours
set_pal=c( "#7FC97F" ,"#FDC086" ,"#FFFF99" ,"#F0027F" ,"#BF5B17" ,"#1B9E77" ,"#D95F02"  ,"#E7298A" ,"#66A61E", "#E6AB02","#A6761D" ,"#1F78B4" ,"#B2DF8A" ,"#33A02C" ,"#FB9A99" ,"#E31A1C" ,"#FDBF6F" ,"#FF7F00" ,"#CAB2D6" ,"#6A3D9A" ,"#FFFF99" ,"#B15928", "#FBB4AE" ,"#B3CDE3" ,"#CCEBC5" ,"#DECBE4" ,"#FED9A6" ,"#FFFFCC" ,"#E5D8BD" ,"#FDDAEC" ,"#B3E2CD" ,"#FDCDAC" ,"#CBD5E8" ,"#F4CAE4" ,"#E6F5C9", "#FFF2AE" ,"#F1E2CC" ,"#E41A1C" ,"#377EB8" ,"#4DAF4A", "#984EA3" ,"#FF7F00" ,"#FFFF33" ,"#A65628" ,"#F781BF" ,"#66C2A5" ,"#FC8D62", "#8DA0CB" ,"#E78AC3" ,"#A6D854" ,"#FFD92F", "#E5C494" ,"#8DD3C7" ,"#FFFFB3" ,"#BEBADA" ,"#FB8072" ,"#80B1D3" ,"#FDB462" ,"#B3DE69" ,"#FCCDE5", "#BC80BD" ,"#CCEBC5" ,"#FFED6F")
#pie(rep(1,length(col_vector)), col=sample(col_vector, length(col_vector)))
names(set_pal) <- colnames(metadata)[clade_cols]
set_pal[names(set_pal)=="Unclassified"]="white"
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal,label=sorted_col_names, breaks=sorted_col_names )
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
sorted_col_names
set_pal
sorted_col_names
#pie(rep(1,length(col_vector)), col=sample(col_vector, length(col_vector)))
names(set_pal) <- sorted_col_names
set_pal[names(set_pal)=="Unclassified"]="white"
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = set_pal,label=sorted_col_names, breaks=sorted_col_names )
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
## colours for lots of data
n <- 40
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))
#pie(rep(1,length(col_vector)), col=sample(col_vector, length(col_vector)))
names(col_vector) <- sorted_col_names
col_vector[names(col_vector)=="Unclassified"]="white"
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = col_vector,label=sorted_col_names, breaks=sorted_col_names )
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
sorted_col_names
## colours for lots of data
n <- 35
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))
#pie(rep(1,length(col_vector)), col=sample(col_vector, length(col_vector)))
names(col_vector) <- sorted_col_names
col_vector[names(col_vector)=="Unclassified"]="white"
colScale <- scale_fill_manual(name = "Phylogenetic Clade (Major_Minor)",values = col_vector,label=sorted_col_names, breaks=sorted_col_names )
# add country names for reference on map
name_country <- c("Brazil", "Mexico", "China", "Indonesia", "South Africa", "Kenya", "Iran", "India", "Argentina", "Russia", "Niger", "Puerto Rico", "Sri Lanka")
plot_world2<-plot_world +
new_scale("fill")+
geom_scatterpie(aes(x=LON, y=LAT,group=region, r=(radius+0.1)), data=metadata, cols=sorted_col_names, fill="darkblue",color=NA, alpha=1)+
new_scale_fill()+
geom_scatterpie(aes(x=LON, y=LAT, group=region, r=radius), data=metadata, cols=sorted_col_names, color=NA, alpha=1,sorted_by_radius = T)+
colScale+
geom_text(data=subset(world2, name %in% name_country),aes(x=X, y=Y, label=name),color = "darkblue", fontface = "bold", check_overlap = F, size=3, nudge_y = -1.5)+
geom_text(data=subset(world2, name=="China"),aes(x=X, y=Y, label=name),color = "lightsteelblue1", fontface = "bold", check_overlap = TRUE, size=3, nudge_y = -1.5)+
coord_sf(xlim = c(-106, 140), ylim = c(-52, 55 ), expand = T)+
# labs(fill = "Phylogenetic Clade (Major_Minor)") +
guides(fill=guide_legend(nrow=5,title.position = "top"))+theme(legend.position="bottom")
plot_world2
